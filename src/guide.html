<main>
<nav><ul><li><a href="#getting-started">Getting started</a><ul><li><a href="#usage-with-babel"><p>Usage with Babel</p>
</a></li><li><a href="#usage-with-typescript"><p>Usage with TypeScript</p>
</a></li></ul></li><li><a href="#performance-optimization">Performance optimization</a><ul><li><a href="#remember-to-use-the-minified-build-in-production"><p>Remember to use the minified build in production</p>
</a></li><li><a href="#avoid-arrow-functions-in-the-component-body"><p>Avoid arrow functions in the component body</p>
</a></li><li><a href="#use-the-immutable-utility-function"><p>Use the <code>immutable</code> utility function</p>
</a></li></ul></li><li><a href="#working-with-mutable-state">Working with mutable state</a><ul><li><a href="#passing-state-objects-as-props"><p>Passing state objects as props</p>
</a></li></ul></li><li><a href="#common-pitfalls">Common pitfalls</a><ul><li><a href="#updating-a-primitive-variable"><p>Updating a primitive variable</p>
</a></li><li><a href="#mutating-objects-not-derived-from-the-state-object"><p>Mutating objects not derived from the state object</p>
</a></li></ul></li><li><a href="#api-reference">API reference</a><ul><li><a href="#h-or-createelement"><p><code>h</code> or <code>createElement</code></p>
</a></li><li><a href="#render"><p><code>render</code></p>
</a></li><li><a href="#createstate"><p><code>createState</code></p>
</a></li><li><a href="#usestate"><p><code>useState</code></p>
</a></li><li><a href="#useref"><p><code>useRef</code></p>
</a></li><li><a href="#useeffect"><p><code>useEffect</code></p>
</a></li><li><a href="#immutable"><p><code>immutable</code></p>
</a></li></ul></li></ul></nav>
<section><div><h1 id="getting-started">Getting started</h1><p>Kaiku is packaged to be easily used in both browser and as a module, no build tools required:</p><pre class="highlighted"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/kaiku<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> render<span class="token punctuation">,</span> createState <span class="token punctuation">}</span> <span class="token operator">=</span> kaiku
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> greeting<span class="token operator">:</span> <span class="token string">'Hello world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre><p>Or, just install the package using your favorite package manager:</p><pre class="highlighted"><span class="token comment"># With NPM</span>
<span class="token function">npm</span> i -s kaiku

<span class="token comment"># With yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> kaiku</pre><h2 id="usage-with-babel">Usage with Babel</h2><p>If you are already using a Babel preset such as <code>@babel/preset-env</code>, you have everything installed to make Kaiku work. The only thing you need to configure is how the JSX elements are transpiled into JavaScript by adding the following modification to your <code>babel.config.json</code> (or wherever your Babel configuration resides):</p><pre class="highlighted"><span class="token punctuation">{</span>
  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"@babel/plugin-transform-react-jsx"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">"pragma"</span><span class="token operator">:</span> <span class="token string">"h"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></pre><h2 id="usage-with-typescript">Usage with TypeScript</h2><p>JSX with TypeScript is currently unsupported due to unfinished typings. The library itself is written strictly in TypeScript, but the way JSX is handled causes friction.</p><p>You can follow the progress on the main Github issue <a href="https://github.com/oamaok/kaiku/issues/3" title="null">here</a>.</p><h1 id="performance-optimization">Performance optimization</h1><p>The global and mutable state management styles of Kaiku allow you to apply some optimizations not necessarily available in other libraries. In this section we will be going over some of them.</p><h2 id="remember-to-use-the-minified-build-in-production">Remember to use the minified build in production</h2><p>Kaiku ships with two distinct builds: <code>kaiku.dev.js</code> and <code>kaiku.min.js</code>. The former includes many debugging checks to catch common bugs, as well as the full name of each internal function. This is really helpful when developing the application, but the performance is significantly worse.</p><p>Once you are ready to ship your application, make sure to switch to the minified version to get the best performance out of your product.</p><h2 id="avoid-arrow-functions-in-the-component-body">Avoid arrow functions in the component body</h2><p>Since Kaiku's global state management is made extremely simple, you can usually hoist the arrow functions you would normally require outside your function components. Consider the following simple case:</p><pre class="highlighted"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> inputValue<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">InputComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Creates a function on every render, bad!</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> evt<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>

  <span class="token comment">// Since the identity of the `handleInput` function changes,</span>
  <span class="token comment">// we also need to replace the previous handler every single time.</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onInput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      The current value reversed is
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  )
}
</span></pre><p>Here our <code>handleInput</code> function is re-created every time the component is rendered. Since the <code>state</code> object can be mutated as you would an ordinary JavaScript object, we can move that function outside the component body:</p><pre class="highlighted"><span class="token comment">// Single function for the entire lifetime of the application!</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> evt<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">InputComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// The input handler doesn't get replaced either.</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onInput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      The current value reversed is
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  )
}</span></pre><h2 id="use-the-immutable-utility-function">Use the <code>immutable</code> utility function</h2><p>Sometimes you need to load large, immutable chunks of data into your state. By default, Kaiku will process the state and starts to keep track of any potential changes to the object. For example, say you have a multilingual website and you fetch and store the translations into the state. You rarely, if ever, want to touch the individual translation fields.</p><p>You can help Kaiku to know it does not need to keep track of changes to any of the individual keys by marking the state as immutable, using the <code>immutable</code> utility function:</p><pre class="highlighted"><span class="token keyword">import</span> <span class="token punctuation">{</span> createState<span class="token punctuation">,</span> immutable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'kaiku'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> translations<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">setLanguage</span><span class="token punctuation">(</span><span class="token parameter">lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>translations <span class="token operator">=</span> <span class="token function">immutable</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">fetchTranslations</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></pre><p>This causes Kaiku to not pay attention to any changes inside the <code>state.translation</code> object. This will both speed up the initial load of the translations <em>and</em> subsequent renders.</p><h1 id="working-with-mutable-state">Working with mutable state</h1><h2 id="passing-state-objects-as-props">Passing state objects as props</h2><pre class="highlighted"><span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> person <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>person<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span>
      <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>person<span class="token punctuation">.</span>checked<span class="token punctuation">}</span></span>
      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// It's this easy!</span>
        person<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token operator">!</span>person<span class="token punctuation">.</span>checked
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    people<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Chris'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'David'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> checkedPeople <span class="token operator">=</span> state<span class="token punctuation">.</span>people<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>checked<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>checkedPeople<span class="token punctuation">.</span>length<span class="token punctuation">}</span><span class="token plain-text"> people checked in.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>people<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span></span> <span class="token attr-name">person</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>person<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></pre><h1 id="common-pitfalls">Common pitfalls</h1><h2 id="updating-a-primitive-variable">Updating a primitive variable</h2><p>With Kaiku's state management, you must always update a field of an object instead of copying the value and updating a secondary variable. Like with your common JavaScript objects, the following won't work:</p><pre class="highlighted"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> counter <span class="token punctuation">}</span> <span class="token operator">=</span> state
<span class="token comment">// This won't update the `state` object!</span>
counter<span class="token operator">++</span></pre><p>Why is this? Consider an ordinary object with a primitive value inside it, in our case a <code>string</code>:</p><pre class="highlighted"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span></pre><p>Since you cannot have references to primitive data types in JavaScript, the following makes a <em>copy</em> of the string instead of passing the reference. So, when we edit the variable, the object's field won't get updated:</p><pre class="highlighted"><span class="token keyword">let</span> foo <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo
foo <span class="token operator">=</span> <span class="token string">'foobar'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// Outputs 'bar'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token comment">// Outputs 'foobar'</span></pre><h2 id="mutating-objects-not-derived-from-the-state-object">Mutating objects not derived from the state object</h2><pre class="highlighted"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre><h1 id="api-reference">API reference</h1><h2 id="h-or-createelement"><code>h</code> or <code>createElement</code></h2><h2 id="render"><code>render</code></h2><h2 id="createstate"><code>createState</code></h2><h2 id="usestate"><code>useState</code></h2><h2 id="useref"><code>useRef</code></h2><p>Under the hood, the <code>useRef</code> implementation is just a small wrapper around the <code>useState</code> hook:</p><pre class="highlighted"><span class="token keyword">const</span> useRef <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">(initialValue?: T): Ref</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> =&gt;
  useState(</span><span class="token punctuation">{</span> current<span class="token operator">:</span> initialValue <span class="token punctuation">}</span><span class="token plain-text">)</span></pre><h2 id="useeffect"><code>useEffect</code></h2><h2 id="immutable"><code>immutable</code></h2></div></section>
</main>